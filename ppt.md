markdown

Collapse

Wrap

Copy
# 无小区大规模 MIMO（Cell-Free Massive MIMO）建模精炼笔记

## 引言与基本原理

无小区大规模 MIMO 是一种新型网络架构，其中大量分布式接入点（APs）在没有传统蜂窝小区边界的情况下，通过协同传输来服务区域内的所有用户。与传统蜂窝网络每个用户仅由单个基站服务不同，无小区架构下所有 AP（或选定的 AP 集合）可以同时为任意用户提供服务，从而消除小区边界造成的干扰和“边缘”效应。这种用户中心（user-centric）的网络理念来源于网络 MIMO/协作多点 (CoMP) 技术，但通过 Massive MIMO 技术的结合，实现了在整个覆盖区域内的统一高性能服务。

这种架构的核心思想是：AP 分布式部署、集中或协同处理，以达到更均匀的服务质量和更高的频谱效率。

**图 1**：传统蜂窝网络 (a) vs. 无小区大规模 MIMO (b) vs. 用户中心的无小区大规模 MIMO 架构 (c)。在无小区架构中，大量 AP 通过前传链路连接到中央处理单元（CPU），协同为所有用户提供服务；而用户中心的无小区架构中，每个用户由其附近的一组 AP 动态组网服务。

无小区大规模 MIMO 系统通常假设工作在时分双工（TDD）模式下，以利用信道的互易性简化下行链路的预编码设计。大量 AP 通过高速前传链路与中央处理单元（CPU）相连（或分布式处理），以协调传输和接收。由于所有 AP 协同工作，理想情况下每个用户终端（UE）都能从多个 AP 的相干联合传输中获益，提升接收信号强度并降低干扰。

然而，全网协作也带来了可扩展性挑战：当 AP 和用户数量增加时，信道状态信息的开销、前传通信和处理复杂度都会急剧上升。为此，实用的无小区系统通常采用用户中心的动态合作簇（DCC）等策略，使每个用户由有限的若干 AP 服务，从而在保证性能的同时控制系统开销。下面，我们将围绕关键理论背景对该系统的建模要点进行精炼阐述。

## 信道建模

在无小区 Massive MIMO 系统中，精确的信道建模对性能评估至关重要。信道通常包含大尺度衰落（路径损耗和阴影衰落）和小尺度衰落（快衰落）两部分。如果 AP 和用户设备都配备多根天线，还需考虑空间相关性（用相关矩阵描述）。下面分别介绍这些要素：

### 大尺度衰落

大尺度衰落描述了因距离衰减和阴影阻挡导致的平均信号强度变化。常用模型是假设信号的平均功率随距离呈幂律衰减，并叠加对数正态阴影衰落。例如，可以定义 AP $$m$$ 与用户 $$k$$ 之间的大尺度衰落系数 $$\beta_{mk}$$ 表示平均信道增益，其典型模型为：

- **路径损耗**：根据传播模型，$$\beta_{mk}$$ 随距离 $$d_{mk}$$ 衰减，如 $$\mathrm{PL}(d_{mk}) \propto d_{mk}^{-\gamma}$$（$$\gamma$$ 为路径损耗指数）。在对数域可以表示为 $$10\log_{10}\beta_{mk} = -\gamma \cdot 10\log_{10}(d_{mk}) + C$$（$$C$$ 为频段相关常数），并可根据经验模型（如 COST-231-Hata 模型等）确定具体公式。
- **阴影衰落**：用一个零均值的对数正态随机变量表示。实际实现中可令 $$\beta_{mk} = \mathrm{PL}(d_{mk}) \times 10^{\frac{X_{mk}}{10}}$$，其中 $$X_{mk} \sim \mathcal{N}(0, \sigma_{\text{shadow}}^2)$$ 表示以分贝计的阴影衰落。$$\sigma_{\text{shadow}}$$ 常取值如 8 dB，表示阴影衰落的标准差。

通过上述模型，我们得到 $$\beta_{mk}$$，它反映了在长时间尺度上 AP-$$m$$ 到用户-$$k$$ 信道的平均强度和衰减。仿真中，常假设大尺度系数在多播时延内保持不变（慢衰落），只随用户位置变化。

### 小尺度衰落

小尺度衰落刻画信号在较小时间/空间尺度上的快速波动，通常由多径干涉引起，可看作随机分布。大规模 MIMO 通常假设瑞利衰落（各径无直视成分）或莱斯衰落（存在一定直视径成分）。在经典瑞利模型下，AP $$m$$ 到用户 $$k$$ 的小尺度信道可以建模为复高斯随机变量 $$g_{mk} \sim \mathcal{CN}(0,1)$$，即幅度服从瑞利分布、相位均匀分布。若考虑 AP 和用户都可能有多天线，则对应的信道向量 $$\mathbf{h}_{mk}$$ 可建模为 $$\mathbf{h}_{mk} \sim \mathcal{CN}(\mathbf{0}, \mathbf{I})$$ 在无相关假设下。

通常假设块衰落模型：在一个相干块（如几毫秒内若干 OFDM 符号）内，$$g_{mk}$$ 保持恒定，块间变化独立。这样，实际信道系数可表示为：
$$h_{mk} = \sqrt{\beta_{mk}} \, g_{mk},$$
其中 $$\sqrt{\beta_{mk}}$$ 表示大尺度衰落的振幅衰减，而 $$g_{mk}$$ 表示小尺度快衰落。这一模型意味着平均功率为 $$\beta_{mk}$$，瞬时归一化为 $$\mathcal{CN}(0, \beta_{mk})$$ 分布。

在仿真实现中，可以如下生成 Rayleigh 信道矩阵的元素（Python 示例）：

```python
# 假设已有距离矩阵 dist[m,k] 以及计算路径损耗的函数 path_loss(d)
beta = path_loss(dist[m,k]) * 10**(sigma_shadow * np.random.randn() / 10)  # 大尺度衰落
h_mk = np.sqrt(beta/2) * (np.random.randn() + 1j*np.random.randn())       # 小尺度瑞利衰落
上述代码中，我们先根据距离计算路径损耗，再乘以阴影衰落因子得到 
𝛽
𝑚
𝑘
β 
mk
​
 ，随后生成复高斯随机数并乘以 
𝛽
𝑚
𝑘
β 
mk
​
 
​
  得到信道系数 
ℎ
𝑚
𝑘
h 
mk
​
 。

空间相关矩阵
当 AP 或用户终端配备有多根天线时，信道的各天线分量之间往往存在空间相关性。例如，AP 阵列天线间距较小时，不同天线看到的信号角度分布相似，会导致其信道增益不独立。为此，可用空间相关矩阵来刻画信道相关性。如果 AP 
𝑚
m 有 
𝑁
N 根天线，用户 
𝑘
k 单天线（下行情况），则 
ℎ
𝑚
𝑘
h 
mk
​
  可视作 
𝑁
×
1
N×1 的向量，其统计分布可定义为：
ℎ
𝑚
𝑘
∼
𝐶
𝑁
(
0
,
𝑅
𝑚
𝑘
)
,
h 
mk
​
 ∼CN(0,R 
mk
​
 ),
其中 
𝑅
𝑚
𝑘
R 
mk
​
  是 
𝑁
×
𝑁
N×N 的正定协方差矩阵，即相关矩阵。
𝑅
𝑚
𝑘
R 
mk
​
  的对角元素通常取 1（各天线增益归一化），而非对角元素反映天线之间的相关系数（可依据经验模型，如指数相关模型：
[
𝑅
𝑚
𝑘
]
𝑖
𝑗
=
𝜌
∣
𝑖
−
𝑗
∣
[R 
mk
​
 ] 
ij
​
 =ρ 
∣i−j∣
 ，
0
≤
𝜌
<
1
0≤ρ<1）。

在仿真中，可先根据阵列几何和散射环境生成 
𝑅
𝑚
𝑘
R 
mk
​
 ，再通过矩阵平方根法获得相关信道：
ℎ
𝑚
𝑘
=
𝑅
𝑚
𝑘
1
/
2
𝑔
𝑚
𝑘
,
h 
mk
​
 =R 
mk
1/2
​
 g 
mk
​
 ,
其中 
𝑔
𝑚
𝑘
∼
𝐶
𝑁
(
0
,
𝐼
𝑁
)
g 
mk
​
 ∼CN(0,I 
N
​
 ) 是独立瑞利信道向量。这种方法确保仿真信道符合指定相关性质。

需要注意，在大规模分布式 AP 场景中，不同 AP 间的阴影衰落也可能相关（例如相邻 AP 受到相似环境遮挡）。不过在基础研究中，经常假设不同 AP 对同一用户的阴影衰落独立，以简化分析。

导频分配与动态合作聚类 (DCC)
无小区 Massive MIMO 系统的一大挑战是导频分配和 AP 合作集的形成。由于所有 AP 共享整个频带，如果用户数 
𝐾
K 超过正交导频的数量 
𝜏
𝑝
τ 
p
​
 ，则必须重用导频，从而导致导频污染：多个用户共享同一导频时，AP 无法将其信道估计完全区分开。合理的导频分配策略和动态合作簇 (Dynamic Cooperation Clustering) 机制可以缓解这一问题，并提高系统可扩展性。

导频分配
在 TDD 模式下，系统通常设有 
𝜏
𝑝
τ 
p
​
  个正交导频序列（长度为 
𝜏
𝑝
τ 
p
​
  符号），用户在上行训练时发送导频，AP 据此估计信道。当 
𝐾
>
𝜏
𝑝
K>τ 
p
​
  时，不可避免会有多个用户共享同一序列（记共享同一导频 
𝑡
t 的用户集合为 
𝑆
𝑡
S 
t
​
 ）。为了减小由此带来的干扰，导频分配需要考虑用户的地理分布和服务 AP 的重叠情况。一种有效的原则是：避免将同一导频分配给由相同 AP 服务的多个用户。换言之，每个 AP 每个导频时隙内只服务至多一个使用该导频的用户。

这样可保证在任何单个 AP 上，同频导频的用户不会相互干扰其信道估计，从物理上降低了导频污染的影响。实现这种原则的具体方法可以包括：根据用户的位置或大尺度衰落划分导频组，或采用图着色算法确保相邻（共享 AP）的用户导频不同。

导频污染会降低信道估计精度并引入额外干扰。特别地，它有两个主要后果：

降低信道估计质量，使得协同传输的效果变差；
使共享导频用户的估计信道彼此相关，在数据传输时造成相干干扰。
因此，除了巧妙的导频指派外，还可以在导频阶段采用功控（例如离 AP 近的用户降低导频功率，以减少对远距用户的干扰）等措施，进一步减轻污染。

动态合作聚簇 (DCC)
动态合作聚簇是无小区网络提高可扩展性和干扰管理的关键机制。由于让每个 AP 服务所有用户在实践中开销巨大，DCC 提倡用户中心的 AP 选择：为每个用户动态挑选一组“服务 AP 簇”，AP 只需与簇内其他 AP 协同服务该特定用户。不同用户的簇可以重叠，且可随时间动态调整，这与传统固定小区或静态分簇形成鲜明对比。

动态聚簇根据大尺度信道条件（如 
𝛽
𝑚
𝑘
β 
mk
​
  大小）来决定哪个 AP 应属于哪个用户的簇。例如，一个简单的用户中心策略是：每个用户选择对自己信道增益最大的 
𝑀
0
M 
0
​
  个 AP 组成服务簇。这些 AP 将负责为该用户进行数据传输和接收，而远距增益小的 AP 可以不参与，降低前传开销和处理复杂度。

DCC 的“动态”体现在簇的组成会随环境和网络状况改变。例如，当用户移动时，其附近高增益的 AP 集合也会相应变化；又或者在不同时刻、不同频段，不同用户的干扰情况变化，系统可以按需调整 AP 簇以优化性能。

值得注意的是，DCC 策略通常与导频分配联动：由于每个用户主要由自己簇内的 AP 服务，那么尽量保证同簇用户使用不同导频，可避免簇内导频污染。因此，初始接入时的联合算法会同时考虑导频分配和簇形成，以达到全局最优。研究表明，采用 DCC 的用户中心无小区系统，在保证每个用户由足够 AP 服务的前提下，其性能可以逼近全协作（所有 AP 服务所有用户）的上界，但开销大幅降低。

在实际仿真或实现中，DCC 算法可能如下伪代码描述：

python

Collapse

Wrap

Copy
# 输入: 每个 AP 对每个用户的平均信道增益 beta[m,k]
for each user k:
    # 选取增益最大的 M0 个 AP 作为服务簇
    cluster_k = np.argsort(beta[:, k])[-M0:]  
    assign user k to all APs in cluster_k
    # 确保这些 AP 在此用户的导频上不服务其他用户（满足每 AP 每导频单用户原则）
上述伪代码体现的策略是一种简单实现。更高级的实现中，还可能加入对 AP 负载的控制（避免某些 AP 同时服务过多用户）以及簇间干扰的评估。不过核心思想都是：根据大尺度增益划分用户-AP 关联关系，并动态更新。

MMSE 信道估计及误差分析
最小均方误差 (MMSE) 信道估计是在导频训练后获取信道状态信息的最优线性估计方法。在无小区 Massive MIMO 中，由于每个 AP 可能服务多个用户且存在导频复用，各 AP 通常各自基于接收到的导频信号进行本地的 MMSE 估计，然后将结果发送到 CPU（集中方案）或直接用于本地数据检测/预编码（分布式方案）。MMSE 估计充分利用了信道的统计先验（例如大尺度衰落 
𝛽
𝑚
𝑘
β 
mk
​
  和空间相关矩阵 
𝑅
𝑚
𝑘
R 
mk
​
 ），相比简单的最小二乘 (LS) 估计能显著提高精度。

信道估计过程：假设导频长度为 
𝜏
𝑝
τ 
p
​
 ，所有用户以功率 
𝑝
𝑝
p 
p
​
  同时发送导频。AP 
𝑚
m 接收到导频序列 
𝑡
t 上的信号为：
𝑦
𝑚
,
𝑡
=
∑
𝑖
∈
𝑆
𝑡
𝑝
𝑝
 
ℎ
𝑚
𝑖
+
𝑛
𝑚
,
y 
m,t
​
 =∑ 
i∈S 
t
​
 
​
  
p 
p
​
 
​
 h 
mi
​
 +n 
m
​
 ,
其中 
𝑆
𝑡
S 
t
​
  是与用户 
𝑘
k 共用导频 
𝑡
t 的用户集合（如果用户 
𝑘
k 的导频是独享的，则 
𝑆
𝑡
S 
t
​
  仅有用户 
𝑘
k 自己），
𝑛
𝑚
n 
m
​
  是观测噪声向量（假设 
𝐶
𝑁
(
0
,
𝜎
2
𝐼
)
CN(0,σ 
2
 I)）。对于单天线 AP 的简单情况，上式可以看作标量相加。同理，
𝑦
𝑚
,
𝑡
y 
m,t
​
  是不同用户导频信道的叠加。

MMSE 估计器利用已知的统计量 
{
𝛽
𝑚
𝑖
,
𝑅
𝑚
𝑖
}
{β 
mi
​
 ,R 
mi
​
 } 计算期望和协方差，从而给出对特定用户 
𝑘
k 信道的最佳线性估计：
ℎ
^
𝑚
𝑘
=
𝐸
[
ℎ
𝑚
𝑘
𝑦
𝑚
,
𝑡
𝐻
]
(
𝐸
[
𝑦
𝑚
,
𝑡
𝑦
𝑚
,
𝑡
𝐻
]
)
−
1
𝑦
𝑚
,
𝑡
.
h
^
  
mk
​
 =E[h 
mk
​
 y 
m,t
H
​
 ](E[y 
m,t
​
 y 
m,t
H
​
 ]) 
−1
 y 
m,t
​
 .

直观来说，MMSE 估计得到的是接收信号 
𝑦
𝑚
,
𝑡
y 
m,t
​
  的一个加权版本，权重选择使得均方误差最小。对于上式，
𝐸
[
𝑦
𝑚
,
𝑡
𝑦
𝑚
,
𝑡
𝐻
]
E[y 
m,t
​
 y 
m,t
H
​
 ] 是导频接收的自相关矩阵，包括了期望信道功率和噪声（在协作簇和导频分配策略合理时，这个矩阵尽可能接近对角矩阵，以减少不同用户分量的耦合）。在实际计算中，AP 可预先计算好这些统计矩阵，然后对每次收到的导频信号直接应用矩阵求逆乘法得到信道估计。例如，对于单天线 AP 的标量情况，MMSE 估计简化为：
ℎ
^
𝑚
𝑘
=
𝑝
𝑝
𝛽
𝑚
𝑘
∑
𝑖
∈
𝑆
𝑡
𝑝
𝑝
𝛽
𝑚
𝑖
+
𝜎
2
/
𝜏
𝑝
 
𝑦
𝑚
,
𝑡
,
h
^
  
mk
​
 = 
∑ 
i∈S 
t
​
 
​
 p 
p
​
 β 
mi
​
 +σ 
2
 /τ 
p
​
 
p 
p
​
 
​
 β 
mk
​
 
​
 y 
m,t
​
 ,
其中分母部分反映了用户 
𝑘
k 在 AP 
𝑚
m 处的导频信号干扰加噪声功率。如果导频 
𝑡
t 仅由用户 
𝑘
k 使用，那么 
𝑆
𝑡
S 
t
​
  无其他用户，估计退化为 
ℎ
^
𝑚
𝑘
=
𝑝
𝑝
𝛽
𝑚
𝑘
𝑝
𝑝
𝛽
𝑚
𝑘
+
𝜎
2
/
𝜏
𝑝
𝑦
𝑚
,
𝑡
h
^
  
mk
​
 = 
p 
p
​
 β 
mk
​
 +σ 
2
 /τ 
p
​
 
p 
p
​
 
​
 β 
mk
​
 
​
 y 
m,t
​
 。

误差分析：MMSE 信道估计的误差 
ℎ
~
𝑚
𝑘
=
ℎ
𝑚
𝑘
−
ℎ
^
𝑚
𝑘
h
~
  
mk
​
 =h 
mk
​
 − 
h
^
  
mk
​
  依然是随机的，可计算其均方误差 (MSE) 或方差来衡量估计精度。以上述标量情况为例，
ℎ
^
𝑚
𝑘
h
^
  
mk
​
  是线性高斯估计，则估计和真实信道呈 Joint Gaussian，可知误差也是高斯且与估计值独立。误差方差为：
MSE
𝑚
𝑘
=
𝐸
{
∣
ℎ
~
𝑚
𝑘
∣
2
}
=
𝛽
𝑚
𝑘
−
𝑝
𝑝
𝛽
𝑚
𝑘
2
∑
𝑖
∈
𝑆
𝑡
𝑝
𝑝
𝛽
𝑚
𝑖
+
𝜎
2
/
𝜏
𝑝
.
MSE 
mk
​
 =E{∣ 
h
~
  
mk
​
 ∣ 
2
 }=β 
mk
​
 − 
∑ 
i∈S 
t
​
 
​
 p 
p
​
 β 
mi
​
 +σ 
2
 /τ 
p
​
 
p 
p
​
 β 
mk
2
​
 
​
 .

从中我们可以看出几个要点：

当没有导频污染（
𝑆
𝑡
S 
t
​
  仅含 
𝑘
k 自己）且信噪比足够高（
𝑝
𝑝
𝛽
𝑚
𝑘
≫
𝜎
2
/
𝜏
𝑝
p 
p
​
 β 
mk
​
 ≫σ 
2
 /τ 
p
​
 ），则 
MSE
𝑚
𝑘
≈
𝛽
𝑚
𝑘
−
𝛽
𝑚
𝑘
=
0
MSE 
mk
​
 ≈β 
mk
​
 −β 
mk
​
 =0，表示可以非常精确地估计信道；实际中有限功率下也会剩下一点误差。
当存在导频污染时，即使 
𝑝
𝑝
→
∞
p 
p
​
 →∞，误差方差也趋近于 
𝛽
𝑚
𝑘
−
𝛽
𝑚
𝑘
2
∑
𝑖
∈
𝑆
𝑡
𝛽
𝑚
𝑖
β 
mk
​
 − 
∑ 
i∈S 
t
​
 
​
 β 
mi
​
 
β 
mk
2
​
 
​
 ，这是一个误差下限，说明导频共享用户之间的干扰使估计不可能完美。这正是导频污染导致的估计精度损失之一。特别地，不同用户共导频导致的估计向量相关还会在数据传输时引入相干干扰，使某些干扰项在结合波束赋形时按天线数放大。
总体而言，MMSE 信道估计通过结合统计先验大大改善了信道 CSI 获取的准确性，但其性能仍受限于导频资源受限和干扰。实际系统设计中，会力图增加导频序列长度（提高 
𝜏
𝑝
τ 
p
​
 ）、合理分配导频以及采用 DCC 策略，来尽可能降低误差对性能的影响。

功率分配（rho_dist）
在无小区大规模 MIMO 系统的下行操作中，功率分配是优化频谱效率（SE）和用户公平性的关键环节。合理的功率分配能够平衡信号强度与干扰抑制，确保每个用户设备（UE）获得适当的服务质量。以下是功率分配的实现方式及其理论背景：

代码实现
python

Collapse

Wrap

Copy
rho_dist = power_allocation(gain_matrix, D, RHO_TOT)
作用：为每个 AP-UE 对分配下行发射功率 
𝜌
𝑙
,
𝑘
ρ 
l,k
​
 ，结果存储在形状为 
(
𝑁
𝑈
𝑀
𝐴
𝑃
,
𝑁
𝑈
𝑀
𝑈
𝐸
)
(NUM 
A
​
 P,NUM 
U
​
 E) 的矩阵中，表示每个接入点（AP） 
𝑙
l 为用户 
𝑘
k 分配的功率。
输入参数：
增益矩阵 
𝑔
𝑎
𝑖
𝑛
𝑚
𝑎
𝑡
𝑟
𝑖
𝑥
gain 
m
​
 atrix：反映大尺度衰落系数 
𝛽
𝑙
,
𝑘
β 
l,k
​
 ，表示 AP 
𝑙
l 到 UE 
𝑘
k 的平均信道增益。
服务矩阵 
𝐷
D：其中 
𝐷
[
𝑙
,
𝑘
]
=
1
D[l,k]=1 表示 AP 
𝑙
l 服务 UE 
𝑘
k，
𝐷
[
𝑙
,
𝑘
]
=
0
D[l,k]=0 表示不服务。
总功率约束 
𝑅
𝐻
𝑂
𝑇
𝑂
𝑇
𝑃
𝐸
𝑅
𝐴
𝑃
RHO 
T
​
 OT 
P
​
 ER 
A
​
 P：每个 AP 可用的最大下行发射功率。
实现细节
对于每个 AP 
𝑙
l：

确定服务 UE 集合：根据服务矩阵 
𝐷
D，找到 AP 
𝑙
l 需要服务的用户集合 
{
𝑘
∣
𝐷
[
𝑙
,
𝑘
]
=
1
}
{k∣D[l,k]=1}。
计算分配权重：采用平方根加权分配方法，计算 
𝛽
𝑙
,
𝑘
β 
l,k
​
 
​
  作为功率分配的权重。这是因为 
𝛽
𝑙
,
𝑘
β 
l,k
​
 
​
  能够反映路径损耗的补偿需求，同时避免对少数强信道用户过度分配功率。
功率分配：将 
𝑅
𝐻
𝑂
𝑇
𝑂
𝑇
𝑃
𝐸
𝑅
𝐴
𝑃
RHO 
T
​
 OT 
P
​
 ER 
A
​
 P 按 
𝛽
𝑙
,
𝑘
β 
l,k
​
 
​
  的比例分配给服务集合中的每个 UE，确保总功率满足约束： 
𝜌
𝑙
,
𝑘
=
𝑅
𝐻
𝑂
𝑇
𝑂
𝑇
𝑃
𝐸
𝑅
𝐴
𝑃
⋅
𝛽
𝑙
,
𝑘
∑
𝑘
′
∈
{
𝑘
∣
𝐷
[
𝑙
,
𝑘
′
]
=
1
}
𝛽
𝑙
,
𝑘
′
.
ρ 
l,k
​
 =RHO 
T
​
 OT 
P
​
 ER 
A
​
 P⋅ 
∑ 
k 
′
 ∈{k∣D[l,k 
′
 ]=1}
​
  
β 
l,k 
′
 
​
 
​
 
β 
l,k
​
 
​
 
​
 . 若 AP 
𝑙
l 不服务任何 UE，则 
𝜌
𝑙
,
𝑘
=
0
ρ 
l,k
​
 =0。
理论联系
上行-下行对偶性：平方根加权分配受到书中 Theorem 6.2 的启发。该定理表明，通过适当的功率分配，下行信号与干扰加噪声比（SINR）可以等于上行 SINR，从而实现对称性能。然而，实际系统中，功率分配需同时考虑每个 AP 的功率约束和用户公平性，因此代码实现并非严格遵循对偶性推导，而是更倾向于实用优化。
公平性与效率平衡：通过 
𝛽
𝑙
,
𝑘
β 
l,k
​
 
​
  分配功率，系统能够在补偿远距离用户路径损耗的同时，避免将过多功率集中于近距离用户，从而提升整体网络的公平性和频谱效率。
下行 SE 计算
下行频谱效率（SE）是衡量无小区大规模 MIMO 系统性能的核心指标，反映了系统在给定带宽下能够传输的有效数据速率。下行 SE 的计算依赖于信道估计质量、预编码方案以及功率分配策略。以下是其实现方式和理论分析：

代码结构
python

Collapse

Wrap

Copy
for scheme in ['MR', 'L-MMSE', 'P-MMSE']:
    se_list_downlink = []
    for ue in ue_list:
        serving_aps = [ap for ap in ap_list if ap.id in ue.assigned_ap_ids]
        if not serving_aps:
            se_list_downlink.append(0.0)
            continue
    
        se_val = compute_downlink_SE(
            serving_aps=serving_aps,
            H_hat=H_hat,           # 信道估计
            H_true=H_true,         # 真实信道
            ue_id=ue.id,
            all_ues=ue_list,
            lN=ANTENNAS_PER_AP,    # 每 AP 天线数
            p=UE_MAX_POWER,        # 用户最大功率（用于上行参考）
            sigma2=NOISE_DL,       # 下行噪声功率
            precoding_scheme=scheme,
            rho_dist=rho_dist,     # 功率分配结果
            D=D,                   # 服务矩阵
            pilot_assignments=pilot_assignments  # 导频分配方案
        )
        se_list_downlink.append(se_val)

    downlink_SE_all[scheme].append(np.mean(se_list_downlink))
结构说明
外层循环：遍历三种预编码方案：
MR (Maximum Ratio)：最大比率预编码，简单高效，适用于信道条件较好的场景。
L-MMSE (Local MMSE)：本地最小均方误差预编码，通过抑制 AP 内的干扰提升性能。
P-MMSE (Partial MMSE)：部分 MMSE 预编码，适用于大规模网络，通过近似全局优化平衡性能与计算复杂度。
内层循环：为每个 UE 计算 SE：
根据服务矩阵 
𝐷
D 和 UE 的服务 AP 列表（ue.assigned_ap_ids）确定服务 AP 集合。
若某 UE 无服务 AP，则 SE 为 0。
调用 compute_downlink_SE 函数计算该 UE 的下行 SE。
输出：每种预编码方案下，所有 UE 的平均 SE 存储在 downlink_SE_all[scheme] 中，用于后续性能对比。
compute_downlink_SE 函数
该函数负责为特定 UE 计算下行 SE，核心步骤包括预编码向量计算和 SINR/SE 计算。

预编码向量计算
根据选择的预编码方案，计算服务 AP 对目标 UE 的预编码向量 
𝑤
𝑙
,
𝑘
w 
l,k
​
 ：

MR 预编码： 
𝑤
𝑙
,
𝑘
=
ℎ
^
𝑙
,
𝑘
𝜌
𝑙
,
𝑘
,
w 
l,k
​
 = 
h
^
  
l,k
​
  
ρ 
l,k
​
 
​
 , 其中，
ℎ
^
𝑙
,
𝑘
h
^
  
l,k
​
  是信道估计，
𝜌
𝑙
,
𝑘
ρ 
l,k
​
  是功率分配值。MR 预编码直接利用信道共轭，计算复杂度低，但不抑制干扰。
L-MMSE 预编码： 
𝑤
𝑙
,
𝑘
=
𝜌
𝑙
,
𝑘
⋅
(
𝐶
int
+
𝜎
2
𝐼
)
−
1
ℎ
^
𝑙
,
𝑘
,
w 
l,k
​
 = 
ρ 
l,k
​
 
​
 ⋅(C 
int
​
 +σ 
2
 I) 
−1
  
h
^
  
l,k
​
 , 其中，
𝐶
int
C 
int
​
  是本地干扰协方差矩阵，考虑服务 AP 内其他 UE 的信号干扰。L-MMSE 通过权衡信号增益与干扰抑制提升性能。
P-MMSE 预编码：采用部分 MMSE 方法，近似全局干扰抑制，具体实现参考书中公式 (6.17)。P-MMSE 在大规模网络中通过折中计算复杂度和性能，提供优于 MR 和 L-MMSE 的结果。
SINR 和 SE 计算
信号功率： |\sum_{l \in \text{serving_aps}} w_{l,k}^H h_{l,k}|^2, 表示服务 AP 对目标 UE 
𝑘
k 的相干信号贡献，其中 
ℎ
𝑙
,
𝑘
h 
l,k
​
  是真实信道。
干扰功率： 
∑
𝑖
≠
𝑘
∑
𝑙
∣
𝑤
𝑙
,
𝑖
𝐻
ℎ
𝑙
,
𝑘
∣
2
,
∑ 
i

=k
​
 ∑ 
l
​
 ∣w 
l,i
H
​
 h 
l,k
​
 ∣ 
2
 , 表示所有其他 UE 
𝑖
i 的预编码向量对目标 UE 
𝑘
k 造成的干扰。
SINR： 
SINR
𝑘
=
信号功率
干扰功率
+
𝜎
2
,
SINR 
k
​
 = 
干扰功率+σ 
2
 
信号功率
​
 , 其中，
𝜎
2
σ 
2
  是下行噪声功率（NOISE_DL）。
SE： 
SE
𝑘
=
log
⁡
2
(
1
+
SINR
𝑘
)
,
SE 
k
​
 =log 
2
​
 (1+SINR 
k
​
 ), 基于香农容量公式，计算 UE 
𝑘
k 的下行频谱效率（单位：bit/s/Hz）。
理论联系
信道估计依赖：下行 SE 高度依赖 MMSE 信道估计的准确性。若导频污染严重，
ℎ
^
𝑙
,
𝑘
h
^
  
l,k
​
  与 
ℎ
𝑙
,
𝑘
h 
l,k
​
  的误差将增加干扰功率，降低 SINR。
预编码方案比较：
MR 预编码简单，适用于低干扰场景，但在高负载下性能受限。
L-MMSE 通过本地干扰抑制改善 SINR，适用于中等规模网络。
P-MMSE 通过部分全局优化，在高干扰或大规模场景中表现更优。
功率分配影响：平方根加权分配通过调整 
𝜌
𝑙
,
𝑘
ρ 
l,k
​
 ，直接影响信号功率和干扰功率的分布，进而优化 SE。